<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Performance Tips · StreamSampling.jl</title><meta name="title" content="Performance Tips · StreamSampling.jl"/><meta property="og:title" content="Performance Tips · StreamSampling.jl"/><meta property="twitter:title" content="Performance Tips · StreamSampling.jl"/><meta name="description" content="Documentation for StreamSampling.jl."/><meta property="og:description" content="Documentation for StreamSampling.jl."/><meta property="twitter:description" content="Documentation for StreamSampling.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">StreamSampling.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Introduction</a></li><li><a class="tocitem" href="../basics/">Basics</a></li><li><a class="tocitem" href="../example/">Some Applications</a></li><li class="is-active"><a class="tocitem" href>Performance Tips</a><ul class="internal"><li><a class="tocitem" href="#Use-Immutable-Reservoir-Samplers"><span>Use Immutable Reservoir Samplers</span></a></li><li><a class="tocitem" href="#Parallel-Sampling-from-Multiple-Streams"><span>Parallel Sampling from Multiple Streams</span></a></li></ul></li><li><a class="tocitem" href="../benchmark/">Benchmarks</a></li><li><a class="tocitem" href="../api/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Performance Tips</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Performance Tips</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/JuliaDynamics/StreamSampling.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/JuliaDynamics/StreamSampling.jl/blob/main/docs/src/perf_tips.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Performance-Tips"><a class="docs-heading-anchor" href="#Performance-Tips">Performance Tips</a><a id="Performance-Tips-1"></a><a class="docs-heading-anchor-permalink" href="#Performance-Tips" title="Permalink"></a></h1><h2 id="Use-Immutable-Reservoir-Samplers"><a class="docs-heading-anchor" href="#Use-Immutable-Reservoir-Samplers">Use Immutable Reservoir Samplers</a><a id="Use-Immutable-Reservoir-Samplers-1"></a><a class="docs-heading-anchor-permalink" href="#Use-Immutable-Reservoir-Samplers" title="Permalink"></a></h2><p>By default, a <code>ReservoirSampler</code> is mutable, however, it is also possible to use an immutable version which supports all the basic operations. It uses <code>Accessors.jl</code> under the hood to update the reservoir.</p><p>Let&#39;s compare the performance of mutable and immutable samplers with a simple benchmark</p><pre><code class="language-julia hljs">using StreamSampling, BenchmarkTools

function fit_iter!(rs, iter)
    for i in iter
        rs = fit!(rs, i) # the reassignment is necessary when `rs` is immutable
    end
    return rs
end

iter = 1:10^7;</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">1:10000000</code></pre><p>Running with both version we get</p><pre><code class="language-julia hljs">@btime fit_iter!(rs, $iter) setup=(rs = ReservoirSampler{Int}(10, AlgRSWRSKIP(); mutable = true))</code></pre><pre><code class="language-julia hljs">  6.535 ms (2 allocations: 144 bytes)</code></pre><pre><code class="language-julia hljs">@btime fit_iter!(rs, $iter) setup=(rs = ReservoirSampler{Int}(10, AlgRSWRSKIP(); mutable = false))</code></pre><pre><code class="language-julia hljs">  4.816 ms (2 allocations: 144 bytes)</code></pre><p>As you can see, the immutable version is 50% faster than  the mutable one. In general, the smaller the ratio between reservoir  size and stream size, the faster the immutable version will be than the mutable one. Be careful though, because calling <code>fit!</code> on an immutable sampler won&#39;t modify it in-place, but only create a new updated instance.</p><h2 id="Parallel-Sampling-from-Multiple-Streams"><a class="docs-heading-anchor" href="#Parallel-Sampling-from-Multiple-Streams">Parallel Sampling from Multiple Streams</a><a id="Parallel-Sampling-from-Multiple-Streams-1"></a><a class="docs-heading-anchor-permalink" href="#Parallel-Sampling-from-Multiple-Streams" title="Permalink"></a></h2><p>Let&#39;s say that you want to split the sampling of an iterator. If you can split the iterator into different partitions then you can update in parallel a reservoir sample for each partition and then merge them together at the end.</p><p>Suppose for instance to have these 2 iterators</p><pre><code class="language-julia hljs">iters = [1:100, 101:200]</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">2-element Vector{UnitRange{Int64}}:
 1:100
 101:200</code></pre><p>then you create two reservoirs of the same type</p><pre><code class="language-julia hljs">rs = [ReservoirSampler{Int}(10, AlgRSWRSKIP()) for i in 1:length(iters)]</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">2-element Vector{StreamSampling.MultiAlgRSWRSKIPSampler_Mut{Nothing, Int64, Random.TaskLocalRNG}}:
 MultiAlgRSWRSKIPSampler_Mut: n=0 | value=Int64[]
 MultiAlgRSWRSKIPSampler_Mut: n=0 | value=Int64[]</code></pre><p>and after that you can just update them in parallel like so</p><pre><code class="language-julia hljs">Threads.@threads for i in 1:length(iters)
    for e in iters[i]
        fit!(rs[i], e)
    end
end</code></pre><p>then you can obtain a unique reservoir containing a summary of the union of the streams with</p><pre><code class="language-julia hljs">merge(rs...)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">MultiAlgRSWRSKIPSampler_Mut: n=200 | value=[80, 37, 48, 91, 1, 56, 120, 104, 158, 138]</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../example/">« Some Applications</a><a class="docs-footer-nextpage" href="../benchmark/">Benchmarks »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.14.1 on <span class="colophon-date" title="Saturday 16 August 2025 22:53">Saturday 16 August 2025</span>. Using Julia version 1.11.6.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
